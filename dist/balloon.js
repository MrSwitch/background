(()=>{window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(e=>setTimeout(e,1e3/60));var it=window.requestAnimationFrame.bind(window);var Y={bubbles:!0,cancelable:!0},T=(e,t=Y)=>new Event(e,t);try{T("test")}catch{T=(e,t=Y)=>{let s=document.createEvent("Event");return s.initEvent(e,!!t.bubbles,!!t.cancelable),s}}var M=T;var D=e=>(e.stopPropagation=()=>{},e.preventDefault=()=>{},e);var g=(e,t)=>t&&e instanceof t;var N=typeof HTMLElement<"u"&&HTMLElement||typeof Element<"u"&&Element,U=typeof HTMLDocument<"u"&&HTMLDocument||typeof Document<"u"&&Document,V=window.constructor,z=e=>g(e,N)||g(e,U)||g(e,V);function W(e){return Array.prototype.slice.call(e)}var I=W;var m=(e,t=()=>{})=>(z(e)?e=[e]:typeof e=="string"&&(e=document.querySelectorAll(e)),g(e,Array)||(e=I(e)),t&&e.forEach(t),e);var $=/[\s,]+/,R=!1;try{let e=Object.defineProperty({},"passive",{get(){R=!0}});window.addEventListener("test",null,e)}catch{}var a=(e,t,s,i=!1)=>(typeof i=="object"&&i.passive&&!R&&(i=!1),t=t.split($),m(e,n=>t.forEach(r=>n.addEventListener(r,s,i))));var A=window.navigator.pointerEnabled,B=A?"MSPointerMove pointerMove":"mousemove touchmove",G=A?"MSPointerDown pointerDown":"mousedown touchstart",K=A?"MSPointerUp pointerUp":"mouseup touchend touchcancel",E=(e,t,s,i)=>{let n={},r={},f={};a(document,B,o=>{if(Z(o))return;let h=o.pointerId||0,c=n[h];if(c&&typeof c=="function"){let d=r[h];v(o,d),c(o,d)}r[h]=o}),a(document,K,o=>{let h=o.pointerId||0;n[h]=null,(o.type==="touchend"||o.type==="touchcancel")&&(o=r[h]);let c=f[h];c&&c(o),f[h]=null}),m(e,o=>{a(o,"selectstart",()=>!1),a(o,G,h=>{let c=h.pointerId||0;v(h),r[c]=h,n[c]=(d,p)=>{t.call(o,d,p,h)},i&&(f[c]=d=>{v(d,h),i.call(o,d,h)}),s&&s.call(o,h)})})};function v(e,t){if(e.gesture={},e&&e.touches&&e.touches.length>0?e.gesture.touches=e.touches:e.gesture.touches=[e],e.gesture.screenX=e.gesture.touches[0].screenX,e.gesture.screenY=e.gesture.touches[0].screenY,"screenX"in e||(e.screenX=e.gesture.screenX),"screenY"in e||(e.screenY=e.gesture.screenY),t){e.gesture.deltaTime=e.timeStamp-t.timeStamp;let s=e.gesture.deltaX=e.gesture.screenX-t.gesture.screenX,i=e.gesture.deltaY=e.gesture.screenY-t.gesture.screenY;Math.abs(i)>Math.abs(s)?e.gesture.direction=i>0?"up":"down":e.gesture.direction=s>0?"right":"left",e.gesture.distance=Math.sqrt(s*s+i*i),e.gesture.velocity=e.gesture.distance/e.gesture.deltaTime}}function Z(e){return(e.pointerType||e.type).match(/mouse/i)&&(e.which||e.buttons)!==1}var{gesture:J}=E,H=(e,t)=>E(e,function(s,i,n){J(s,n),s.gesture.type=`drag${s.gesture.direction}`,t.call(this,s)},function(s){s.gesture.type="start",t.call(this,s)},function(s){let i=s.gesture;i.deltaTime<200&&i.distance>20&&i.velocity>.3?i.type=`swipe${i.direction}`:i.distance<20?i.type="click":i.type="release",t.call(this,s)});var O="background",q=["click","mousedown","mouseup","mouseover","mousemove","mouseout","frame","resize","keydown"],C=["touchmove","touchstart","touchend"],Q=/[\s,]+/,y=class{constructor(t){let s;if(this.events={},"getContext"in document.createElement("canvas")){t&&t instanceof HTMLCanvasElement?(this.target=t,s=t.parentNode):(s=t,t=document.createElement("canvas"),t.style.backgroundColor="white",s||(s=document.body,t.style.cssText="position:fixed;z-index:-1;top:0;left:0;",t.setAttribute("tabindex",0),document.documentElement.style.cssText="min-height:100%;",document.body.style.cssText="min-height:100%;",window.addEventListener("resize",this.resize.bind(this))),s.insertBefore(t,s.firstElementChild),this.target=t,this.resize()),this.ctx=t.getContext("2d"),this.ctx.save(),this._time=0,this._fps=0,this.draw(),a(this.target,q.toString(),this.dispatchEvent.bind(this),{passive:!0}),a(this.target,C.toString(),this.dispatchTouchEvent.bind(this),{passive:!0}),s===document.body&&t.style.getPropertyValue("z-index")==="-1"&&(a(document,q.toString(),this.dispatchEvent.bind(this),{passive:!0}),a(document,C.toString(),this.dispatchTouchEvent.bind(this),{passive:!0}));{let i=this.target.style,n=i.getPropertyValue("z-index");window.addEventListener("hashchange",F.bind(i,n)),F.call(i,n)}this.swipe&&H(this.target,this.swipe.bind(this))}}get width(){return this.target.width}set width(t){this.target.width=t}get height(){return this.target.height}set height(t){this.target.height=t}get fps(){return this._fps}set fps(t){this._fps=t;let s=new Date().getTime();s-this._time>1e3&&(this._time=s,this._fps=0)}resize(){let t=this.target.parentNode===document.body?document.documentElement:this.target.parentNode,s=t.clientHeight,i=t.clientWidth,n=!1;this.width!==i&&(n=!0,this.width=i),this.height!==s&&(n=!0,this.height=s),n&&this.target.dispatchEvent(M("resize"))}clear(){this.ctx.clearRect(0,0,this.target.width,this.target.height)}bringToFront(){window.location.hash=O}draw(){this.fps++,this.target.dispatchEvent(M("frame")),requestAnimationFrame(this.draw.bind(this))}addEventListener(t,s){t.split(Q).forEach(i=>{i in this.events||(this.events[i]=[]),this.events[i].push(s)})}dispatchEvent(t){t.type in this.events&&(t.currentTarget===document&&(t=D({type:t.type,target:this.target,offsetX:t.pageX||t.offsetX,offsetY:t.pageY||t.offsetY})),this.events[t.type].forEach(i=>i(t)),t.stopPropagation())}dispatchTouchEvent(t){let s=(t.touches||t.changedTouches)[0];s&&(t.offsetX=Math.abs(s.pageX||s.screenX),t.offsetY=Math.abs(s.pageY||s.screenY)),this.dispatchEvent(t)}};function F(e){let t="z-index";window.location.hash===`#${O}`&&(e=1e4),e!==void 0?this.setProperty(t,e):this.removeProperty(t)}var tt=["click","mousedown","mouseup","mouseover","mousemove","mouseout","touchmove","touchstart","touchend","frame"],w=class{constructor(t){this.children=[],this.events=[],this.init(t)}init(t){this.target=t,this.ctx=t.getContext("2d"),a(t,tt.toString(),this._findAndDispatch.bind(this),{passive:!0})}push(t){t.dirty=!0,this.children.indexOf(t)===-1&&(t.setup&&t.setup(this),this.children.push(t))}findIndex(t){return this.children.findIndex(t)}find(t){return this.children.find(t)}get length(){return this.children.length}set length(t){this.children.length=t}prepare(){this.children.forEach(t=>{t.dirty===!0&&this.prepareChild(t)})}prepareChild(t){let s=this.ctx;t.dirty!=="pending"&&(t.dirty="pending",s.clearRect(t.x,t.y,t.w,t.h),t.previous&&et(t.previous,t)&&s.clearRect(t.previous.x,t.previous.y,t.previous.w,t.previous.h),this.children.forEach(this._prepareSiblings.bind(this,t)))}_prepareSiblings(t,s){!s.dirty&&s.visible!==!1&&(x(s,t)||t.past&&x(s,t.past))&&this.prepareChild(s)}sort(){this.children.sort((t,s)=>(t=t.zIndex||0,s=s.zIndex||0,+(t>s)||-(t<s)))}draw(){let t=this.ctx;this.children.forEach(s=>{s.frame&&s.frame(t),s.dirty&&s.visible!==!1&&s.draw(t),s.dirty=!1})}elementFromPoint(t,s){let i,n={x:t,y:s,w:1,h:1};return this.children.forEach(r=>{r.visible===!1||!r.w||!r.h||r.pointerEvents===!1||x(n,r)&&(i=r)}),i}addEventListener(t,s){t in this.events||(this.events[t]=[]),this.events[t].push(s)}dispatchEvent(t){t.type in this.events&&this.events[t.type].forEach(s=>s(t))}_findAndDispatch(t){if(typeof MouseEvent<"u"&&t instanceof MouseEvent||typeof TouchEvent<"u"&&t instanceof TouchEvent){let s={x:t.offsetX,y:t.offsetY,w:1,h:1};this.children.forEach(i=>{!i.visible||!i.w||!i.h||!i.pointerEvents||x(s,i)&&i.dispatchEvent(t)})}}};function x(e,t){return!(e.x>t.x+t.w||e.x+e.w<t.x||e.y>t.y+t.h||e.y+e.h<t.y)}function et(e,t){return e.x!==t.x||e.y!==t.y||e.w!==t.w||e.h!==t.h}var st=2*Math.PI,S=[],_=class{constructor(t,s,i){this.cx=t,this.cy=s,this.r=i,this.ascending=!0,this.fillStyle="black",this.calc()}calc(){let t=this.r;this.x=this.cx-t,this.y=this.cy-t,this.w=t*2,this.h=t*2}draw(t){if(this.r<=0){this.r=0;return}let s=this.fillStyle+this.r;if(!(s in S)){let i=document.createElement("canvas");i.width=Math.ceil(this.w)+2,i.height=Math.ceil(this.h)+2;let n=i.getContext("2d");n.fillStyle=this.fillStyle,n.beginPath(),n.arc(this.r+1,this.r+1,this.r,0,st,!1),n.fill(),S[s]=i}t.drawImage(S[s],this.x-1,this.y-1)}frame(){this.r<=0?this.ascending=!0:this.r>=P&&(this.ascending=!1),this.r+=(this.ascending?1:-1)*(P/200),this.calc(),this.dirty=!0}},l=new y,b=new w(l.target);l.addEventListener("resize",j);l.addEventListener("frame",()=>{l.ctx.clearRect(0,0,l.width,l.height),b.draw()});var k=[],P;j();function j(){let t=l.width,s=l.height,n=s*t/100,r=Math.sqrt(n),f=r,o=Math.floor(t/r)||1,h=Math.floor(s/f)||1;r=t/o,f=s/h;let c=Math.max(r,f)/2;P=c*1.5;for(let d=0;d<o;d++){c=(d+1)/o*r/2;for(let p=0;p<h;p++){let L=parseInt(d*r+r/2,10),X=parseInt(p*f+f/2,10),u=k[d*h+p];u?(b.push(u),u.cx=L,u.cy=X,u.r=c,u.ascending=!0):(u=new _(L,X,c),b.push(u),k.push(u))}}b.length=o*h}})();
//# sourceMappingURL=balloon.js.map
