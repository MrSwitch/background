{
  "version": 3,
  "sources": ["../node_modules/tricks/support/requestAnimationFrame.js", "../node_modules/tricks/events/createEvent.js", "../node_modules/tricks/events/createDummyEvent.js", "../node_modules/tricks/object/instanceOf.js", "../node_modules/tricks/dom/isDom.js", "../node_modules/tricks/array/toArray.js", "../node_modules/tricks/dom/each.js", "../node_modules/tricks/events/on.js", "../node_modules/tricks/events/touch.js", "../node_modules/tricks/events/swipe.js", "../src/classes/canvas.js", "../src/classes/collection.js", "../src/classes/shape.js", "../src/classes/text.js", "../src/classes/rect.js", "../node_modules/tricks/object/Queue.js", "../src/classes/Background.js", "../src/classes/colours.js", "../src/tetris.js"],
  "sourcesContent": ["// requestAnimationFrame polyfill\nwindow.requestAnimationFrame =\n\twindow.requestAnimationFrame ||\n\twindow.webkitRequestAnimationFrame ||\n\twindow.mozRequestAnimationFrame ||\n\twindow.oRequestAnimationFrame ||\n\twindow.msRequestAnimationFrame ||\n\t(callback => setTimeout(callback, 1000 / 60));\n\nexport default window.requestAnimationFrame.bind(window);\n", "// IE does not support `new Event()`\n// See https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Creating_and_triggering_events for details\nconst dict = {bubbles: true, cancelable: true};\n\nlet createEvent = (eventname, options = dict) =>\n\tnew Event(eventname, options);\n\ntry {\n\tcreateEvent('test');\n}\ncatch {\n\tcreateEvent = (eventname, options = dict) => {\n\t\tconst e = document.createEvent('Event');\n\t\te.initEvent(eventname, !!options.bubbles, !!options.cancelable);\n\t\treturn e;\n\t};\n}\n\nexport default createEvent;\n", "export default e => {\n\te.stopPropagation = () => {};\n\te.preventDefault = () => {};\n\treturn e;\n};\n", "export default (test, root) => root && test instanceof root;\n", "import instanceOf from '../object/instanceOf.js';\n\nconst _HTMLElement = (typeof HTMLElement !== 'undefined' && HTMLElement) || (typeof Element !== 'undefined' && Element);\nconst _HTMLDocument = (typeof HTMLDocument !== 'undefined' && HTMLDocument) || (typeof Document !== 'undefined' && Document);\nconst _Window = window.constructor;\n\nexport default test =>\n\tinstanceOf(test, _HTMLElement) ||\n\t\tinstanceOf(test, _HTMLDocument) ||\n\t\tinstanceOf(test, _Window)\n;\n", "/**\n * Converts an iterable value to an Array\n * @param {object} obj - Object to convert into an array\n * @returns {Array} The object as an array\n */\nfunction toArray(obj) {\n\treturn Array.prototype.slice.call(obj);\n}\n\nexport default toArray;\n", "import isDom from './isDom.js';\nimport instanceOf from '../object/instanceOf.js';\nimport toArray from '../array/toArray.js';\n\nexport default function each(matches, callback = () => {}) {\n\n\tif (isDom(matches)) {\n\t\tmatches = [matches];\n\t}\n\telse if (typeof(matches) === 'string') {\n\t\tmatches = document.querySelectorAll(matches);\n\t}\n\n\tif (!instanceOf(matches, Array)) {\n\t\tmatches = toArray(matches);\n\t}\n\n\tif (callback) {\n\t\tmatches.forEach(callback);\n\t}\n\n\treturn matches;\n}\n", "// on.js\n// Listen to events, this is a wrapper for addEventListener\n\nimport each from '../dom/each.js';\nconst SEPERATOR = /[\\s,]+/;\n\n// See https://github.com/WICG/EventListenerOptions/blob/gh-pages/explainer.md#feature-detection\nlet supportsPassive = false;\ntry {\n\tconst opts = Object.defineProperty({}, 'passive', {\n\t\tget() { // eslint-disable-line getter-return\n\t\t\tsupportsPassive = true;\n\t\t}\n\t});\n\twindow.addEventListener('test', null, opts);\n}\ncatch {\n\t// Continue\n}\n\n\nexport default function on(elements, eventnames, callback, options = false) {\n\n\tif (typeof options === 'object' && options.passive && !supportsPassive) {\n\t\t// Override the passive mark\n\t\toptions = false;\n\t}\n\n\teventnames = eventnames.split(SEPERATOR);\n\treturn each(elements, el => eventnames.forEach(eventname => el.addEventListener(eventname, callback, options)));\n}\n", "// Standardizes touch events\n// Calculate the difference from the starting position and the end position.\n// Returns a gesture object given\n\nimport on from './on.js';\nimport each from '../dom/each.js';\n\n// Does this support pointer events?\nconst pointerEnabled = window.navigator.pointerEnabled;\nconst eventMoveTypes = pointerEnabled ? 'MSPointerMove pointerMove' : 'mousemove touchmove';\nconst eventStartTypes = pointerEnabled ? 'MSPointerDown pointerDown' : 'mousedown touchstart';\nconst eventEndTypes = pointerEnabled ? 'MSPointerUp pointerUp' : 'mouseup touchend touchcancel';\n\n// Touch\n// @param callback function - Every touch event fired\n// @param complete function- Once all touch event ends\nexport default function touch(elements, onmove, onstart, onend) {\n\n\t// Store callbacks, and previous pointer position\n\tconst cb = {};\n\tconst mv = {};\n\tconst fin = {};\n\n\ton(document, eventMoveTypes, moveEvent => {\n\n\t\t// Fix Android not firing multiple moves\n\t\t// if (e.type.match(/touch/i)) {\n\t\t//   e.preventDefault();\n\t\t// }\n\n\t\t// Pointer/Mouse down?\n\t\tif (voidEvent(moveEvent)) {\n\t\t\t// The mouse buttons isn't pressed, kill this\n\t\t\treturn;\n\t\t}\n\n\t\t// trigger the call\n\t\tconst i = moveEvent.pointerId || 0;\n\t\tconst handler = cb[i];\n\n\t\tif (handler && typeof(handler) === 'function') {\n\n\t\t\tconst prevEvent = mv[i];\n\n\t\t\t// Extend the Event Object with 'gestures'\n\t\t\tgesture(moveEvent, prevEvent);\n\n\t\t\t// Trigger callback\n\t\t\thandler(moveEvent, prevEvent);\n\t\t}\n\n\t\tmv[i] = moveEvent;\n\t});\n\n\ton(document, eventEndTypes, e => {\n\n\t\tconst i = e.pointerId || 0;\n\t\tcb[i] = null;\n\n\t\tif (e.type === 'touchend' || e.type === 'touchcancel') {\n\t\t\te = mv[i];\n\t\t}\n\n\t\tconst handler = fin[i];\n\t\tif (handler) {\n\t\t\thandler(e);\n\t\t}\n\n\t\tfin[i] = null;\n\t});\n\n\t// loop through and add events\n\teach(elements, element => {\n\n\t\t// bind events\n\t\t// on(element, 'touchend', e => {\n\t\t//  console.log('el:touchend');\n\t\t//  console.log(e);\n\t\t// });\n\n\t\ton(element, 'selectstart', () => false);\n\n\t\ton(element, eventStartTypes, startEvent => {\n\n\t\t\t// default pointer ID\n\t\t\tconst i = startEvent.pointerId || 0;\n\n\t\t\t// Add Gestures to event Object\n\t\t\tgesture(startEvent);\n\n\t\t\tmv[i] = startEvent;\n\t\t\tcb[i] = (moveEvent, prevMoveEvent) => {\n\t\t\t\tonmove.call(element, moveEvent, prevMoveEvent, startEvent);\n\t\t\t};\n\n\t\t\tif (onend) {\n\t\t\t\tfin[i] = endEvent => {\n\n\t\t\t\t\t// Add Gestures to event Object\n\t\t\t\t\tgesture(endEvent, startEvent);\n\n\t\t\t\t\t// fire complete callback\n\t\t\t\t\tonend.call(element, endEvent, startEvent);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// trigger start\n\t\t\tif (onstart) {\n\t\t\t\tonstart.call(element, startEvent);\n\t\t\t}\n\t\t});\n\t});\n}\n\nexport function gesture(currEvent, prevEvent) {\n\n\t// Response Object\n\tcurrEvent.gesture = {};\n\n\tif (currEvent && currEvent.touches && currEvent.touches.length > 0) {\n\t\tcurrEvent.gesture.touches = currEvent.touches;\n\t}\n\telse {\n\t\tcurrEvent.gesture.touches = [currEvent];\n\t}\n\n\tcurrEvent.gesture.screenX = currEvent.gesture.touches[0].screenX;\n\tcurrEvent.gesture.screenY = currEvent.gesture.touches[0].screenY;\n\n\tif (!('screenX' in currEvent)) {\n\t\tcurrEvent.screenX = currEvent.gesture.screenX;\n\t}\n\tif (!('screenY' in currEvent)) {\n\t\tcurrEvent.screenY = currEvent.gesture.screenY;\n\t}\n\n\t// If the second parameter isn't defined then we're unable to define getures\n\t// But if it is then whoop, lets go.\n\tif (prevEvent) {\n\n\t\tcurrEvent.gesture.deltaTime = (currEvent.timeStamp - prevEvent.timeStamp);\n\n\t\tconst dx = currEvent.gesture.deltaX = currEvent.gesture.screenX - prevEvent.gesture.screenX;\n\t\tconst dy = currEvent.gesture.deltaY = currEvent.gesture.screenY - prevEvent.gesture.screenY;\n\n\t\t// Which is the best direction for the gesture?\n\t\tif (Math.abs(dy) > Math.abs(dx)) {\n\t\t\tcurrEvent.gesture.direction = (dy > 0 ? 'up' : 'down');\n\t\t}\n\t\telse {\n\t\t\tcurrEvent.gesture.direction = (dx > 0 ? 'right' : 'left');\n\t\t}\n\n\t\t// Distance\n\t\tcurrEvent.gesture.distance = Math.sqrt((dx * dx) + (dy * dy));\n\n\t\t// Velocity\n\t\tcurrEvent.gesture.velocity = currEvent.gesture.distance / currEvent.gesture.deltaTime;\n\t}\n}\n\nfunction voidEvent(event) {\n\tconst type = event.pointerType || event.type;\n\treturn (type.match(/mouse/i) && (event.which || event.buttons) !== 1);\n}\n", "// swipe\n// Checks for a swipe to the left or to the right\n\nimport touch, {gesture} from './touch.js';\n\nexport default function swipe(elements, callback) {\n\n\treturn touch(elements, function touchMove(e, o, s) {\n\n\t\tgesture(e, s);\n\n\t\te.gesture.type = `drag${e.gesture.direction}`;\n\n\t\tcallback.call(this, e);\n\n\t},\n\tfunction touchStart(e) {\n\t\te.gesture.type = 'start';\n\t\tcallback.call(this, e);\n\t},\n\tfunction touchEnd(e) {\n\n\t\tconst g = e.gesture;\n\n\t\t// How long did this operation take?\n\t\tif (g.deltaTime < 200 && g.distance > 20 && g.velocity > 0.3) {\n\t\t\tg.type = `swipe${g.direction}`;\n\t\t}\n\t\telse if (g.distance < 20) {\n\t\t\tg.type = 'click';\n\t\t}\n\t\telse {\n\t\t\tg.type = 'release';\n\t\t}\n\n\t\tcallback.call(this, e);\n\t});\n\n}\n", "// Setup\n// This constructs the canvas object\n\n// Includes\nimport 'tricks/support/requestAnimationFrame';\nimport createEvent from 'tricks/events/createEvent';\nimport createDummyEvent from 'tricks/events/createDummyEvent';\nimport on from 'tricks/events/on';\nimport swipe from 'tricks/events/swipe';\n\n// Constants\nconst BACKGROUND_HASH = 'background';\nconst UserEvents = ['click', 'mousedown', 'mouseup', 'mouseover', 'mousemove', 'mouseout', 'frame', 'resize', 'keydown'];\nconst TouchEvents = ['touchmove', 'touchstart', 'touchend'];\n\nconst EVENT_SEPARATOR = /[\\s,]+/;\n\nexport default class Canvas {\n\n\t// Construct the Canvas Element\n\t// @param canvas should be an root element container for this imagery.\n\tconstructor(canvas) {\n\n\t\tlet parent;\n\n\t\t// events\n\t\tthis.events = {};\n\n\t\t// browser check\n\t\tif (!('getContext' in document.createElement('canvas'))) {\n\t\t\t// browser doesn't support canvas\n\t\t\treturn;\n\t\t}\n\n\t\tif (!(canvas && canvas instanceof HTMLCanvasElement)) {\n\n\t\t\t// Set the parent\n\t\t\tparent = canvas;\n\n\t\t\t// Create the canvas layer\n\t\t\tcanvas = document.createElement('canvas');\n\t\t\tcanvas.style.backgroundColor = 'white';\n\n\t\t\t// Not a parent\n\t\t\tif (!parent) {\n\t\t\t\t// Append to the body\n\t\t\t\tparent = document.body;\n\t\t\t\tcanvas.style.cssText = 'position:fixed;z-index:-1;top:0;left:0;';\n\t\t\t\tcanvas.setAttribute('tabindex', 0);\n\n\t\t\t\tdocument.documentElement.style.cssText = 'min-height:100%;';\n\t\t\t\tdocument.body.style.cssText = 'min-height:100%;';\n\n\t\t\t\t// Bind window resize events\n\t\t\t\twindow.addEventListener('resize', this.resize.bind(this));\n\t\t\t}\n\n\t\t\t// Append this element\n\t\t\tparent.insertBefore(canvas, parent.firstElementChild);\n\n\t\t\tthis.target = canvas;\n\n\t\t\tthis.resize();\n\t\t}\n\t\telse {\n\t\t\tthis.target = canvas;\n\t\t\tparent = canvas.parentNode;\n\t\t}\n\n\t\tthis.ctx = canvas.getContext('2d');\n\n\t\t// Set initial save point\n\t\tthis.ctx.save();\n\n\t\t// Initiate the time\n\t\tthis._time = 0;\n\t\tthis._fps = 0;\n\n\t\t// Initiate the draw\n\t\tthis.draw();\n\n\t\t// Bind events\n\t\ton(this.target, UserEvents.toString(), this.dispatchEvent.bind(this), {passive: true});\n\n\t\t// Format Touch events\n\t\ton(this.target, TouchEvents.toString(), this.dispatchTouchEvent.bind(this), {passive: true});\n\n\t\t// In IE user-events aren't propagated to elements which have negative z-Index's\n\t\t// Listen to events on the document element and propagate those accordingly\n\t\tif (parent === document.body && canvas.style.getPropertyValue('z-index') === '-1') {\n\t\t\t// Bind events\n\t\t\ton(document, UserEvents.toString(), this.dispatchEvent.bind(this), {passive: true});\n\n\t\t\t// Format Touch events\n\t\t\ton(document, TouchEvents.toString(), this.dispatchTouchEvent.bind(this), {passive: true});\n\t\t}\n\n\t\t// Listen to hashChange events\n\t\t{\n\t\t\t// HASH CHANGE DEPTH\n\t\t\tconst style = this.target.style;\n\t\t\tconst initialZ = style.getPropertyValue('z-index');\n\t\t\t// Listen to changes to the background hash to bring the canvas element to the front\n\t\t\twindow.addEventListener('hashchange', hashchange.bind(style, initialZ));\n\n\t\t\thashchange.call(style, initialZ);\n\t\t}\n\n\t\t// Is there a swipe method handler\n\t\tif (this.swipe) {\n\t\t\t// Bind the swipe event handler to the event\n\t\t\tswipe(this.target, this.swipe.bind(this));\n\t\t}\n\t}\n\n\t// ensure its keeping up.\n\tget width() {\n\t\treturn this.target.width;\n\t}\n\tset width(value) {\n\t\tthis.target.width = value;\n\t}\n\n\tget height() {\n\t\treturn this.target.height;\n\t}\n\tset height(value) {\n\t\tthis.target.height = value;\n\t}\n\tget fps() {\n\t\treturn this._fps;\n\t}\n\tset fps(value) {\n\n\t\tthis._fps = value;\n\n\t\tconst now = (new Date()).getTime();\n\n\t\tif ((now - this._time) > 1000) {\n\t\t\t// console.log('fps: %d', this._fps);\n\t\t\tthis._time = now;\n\t\t\tthis._fps = 0;\n\t\t}\n\t}\n\n\n\tresize() {\n\t\tconst parent = (this.target.parentNode === document.body) ? document.documentElement : this.target.parentNode;\n\t\tconst height = parent.clientHeight;\n\t\tconst width = parent.clientWidth;\n\t\tlet changed = false;\n\n\t\tif (this.width !== width) {\n\t\t\tchanged = true;\n\t\t\tthis.width = width;\n\t\t}\n\t\tif (this.height !== height) {\n\t\t\tchanged = true;\n\t\t\tthis.height = height;\n\t\t}\n\n\t\tif (changed) {\n\t\t\tthis.target.dispatchEvent(createEvent('resize'));\n\t\t}\n\t}\n\n\tclear() {\n\t\tthis.ctx.clearRect(0, 0, this.target.width, this.target.height);\n\t}\n\n\t// Bring the content of the canvas to the front\n\tbringToFront() {\n\n\t\t// Update the window.location with the hash #background\n\t\twindow.location.hash = BACKGROUND_HASH;\n\t}\n\n\t// Trigger the draw function\n\tdraw() {\n\n\t\t// Increment the number of frames\n\t\tthis.fps++;\n\n\t\t// Call the frame function in the context of the frame to draw\n\t\tthis.target.dispatchEvent(createEvent('frame'));\n\n\t\t// Request another frame\n\t\trequestAnimationFrame(this.draw.bind(this));\n\t}\n\n\t// The user has clicked an item on the page\n\taddEventListener(eventnames, handler) {\n\n\t\teventnames.split(EVENT_SEPARATOR).forEach(eventname => {\n\t\t\t// Add to the events list\n\t\t\tif (!(eventname in this.events)) {\n\t\t\t\tthis.events[eventname] = [];\n\t\t\t}\n\n\t\t\tthis.events[eventname].push(handler);\n\t\t});\n\t}\n\n\t// Dispatch\n\tdispatchEvent(e) {\n\n\t\tif (e.type in this.events) {\n\n\t\t\tconst target = e.currentTarget;\n\n\t\t\t// This was triggered using event delegation, aka in the background\n\t\t\tif (target === document) {\n\n\t\t\t\te = createDummyEvent({\n\t\t\t\t\ttype: e.type,\n\t\t\t\t\ttarget: this.target,\n\t\t\t\t\toffsetX: e.pageX || e.offsetX,\n\t\t\t\t\toffsetY: e.pageY || e.offsetY\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.events[e.type].forEach(handler => handler(e));\n\t\t\te.stopPropagation();\n\t\t}\n\t}\n\n\t// Dispatch\n\tdispatchTouchEvent(e) {\n\t\t// If this was a touch event\n\t\t// Determine the offset to the canvas element relative to the item being clicked\n\t\tconst touch = (e.touches || e.changedTouches)[0];\n\t\tif (touch) {\n\t\t\te.offsetX = Math.abs(touch.pageX || touch.screenX);\n\t\t\te.offsetY = Math.abs(touch.pageY || touch.screenY);\n\t\t}\n\n\t\tthis.dispatchEvent(e);\n\t}\n}\n\n\nfunction hashchange(z) {\n\n\tconst zIndex = 'z-index';\n\n\tif (window.location.hash === `#${ BACKGROUND_HASH}`) {\n\t\tz = 10000;\n\t}\n\n\tif (z !== undefined) {\n\t\t// Set the z-Index\n\t\tthis.setProperty(zIndex, z);\n\t}\n\telse {\n\t\t// Remove the z-Index\n\t\tthis.removeProperty(zIndex);\n\t}\n}\n", "// Collection\n\nimport on from 'tricks/events/on';\nconst UserEvents = ['click', 'mousedown', 'mouseup', 'mouseover', 'mousemove', 'mouseout', 'touchmove', 'touchstart', 'touchend', 'frame'];\n\nexport default class Collection {\n\n\tconstructor(target) {\n\t\t// Create an empty children\n\t\tthis.children = [];\n\n\t\t// Events\n\t\tthis.events = [];\n\n\t\t// setup the canvas element\n\t\tthis.init(target);\n\t}\n\n\t// listen to canvas events\n\tinit (target) {\n\n\t\t// Define the canvas object as the target for the collection\n\t\tthis.target = target;\n\n\t\t// Define the CTX\n\t\tthis.ctx = target.getContext('2d');\n\n\t\t// listen to user interactive events and trigger those on items\n\t\ton(target, UserEvents.toString(), this._findAndDispatch.bind(this), {passive: true});\n\n\t}\n\n\tpush(item) {\n\t\titem.dirty = true;\n\n\t\t// Is this item already in the collection?\n\t\tif (this.children.indexOf(item) === -1) {\n\t\t\tif (item.setup) {\n\t\t\t\titem.setup(this);\n\t\t\t}\n\n\t\t\t// item.addEventListener('dirty', this.prepareChild.bind(this, item));\n\t\t\tthis.children.push(item);\n\t\t}\n\t}\n\n\tfindIndex(fn) {\n\t\treturn this.children.findIndex(fn);\n\t}\n\n\tfind(fn) {\n\t\treturn this.children.find(fn);\n\t}\n\n\tget length () {\n\t\treturn this.children.length;\n\t}\n\tset length (v) {\n\t\tthis.children.length = v;\n\t}\n\n\n\t// Touch\n\t// Mark items and objects in the same space to be redrawn\n\tprepare() {\n\t\tthis.children.forEach(item => {\n\t\t\tif (item.dirty === true)\n\t\t\t\tthis.prepareChild(item);\n\t\t});\n\t}\n\n\t// Clean Item\n\tprepareChild(item) {\n\n\t\tconst ctx = this.ctx;\n\n\t\tif (item.dirty === 'pending') {\n\t\t\treturn;\n\t\t}\n\n\t\t// Mark this item as dirty\n\t\titem.dirty = 'pending';\n\n\t\t// Remove from Canvas\n\t\tctx.clearRect(item.x, item.y, item.w, item.h);\n\n\t\t// If the items old position is different\n\t\tif (item.previous && displaced(item.previous, item)) {\n\t\t\tctx.clearRect(item.previous.x, item.previous.y, item.previous.w, item.previous.h);\n\t\t}\n\n\t\t// Loop though objects and redraw those that exist within the position\n\t\tthis.children.forEach(this._prepareSiblings.bind(this, item));\n\t}\n\n\t_prepareSiblings(item, sibling) {\n\n\t\t// Does this Object overlap with the focused object?\n\t\tif (!sibling.dirty && sibling.visible !== false && (intersect(sibling, item) || (item.past ? intersect(sibling, item.past) : false))) {\n\t\t\t// Nested clean\n\t\t\tthis.prepareChild(sibling);\n\t\t}\n\t}\n\n\tsort() {\n\t\t// Sort items by z-index\n\t\tthis.children.sort((a, b) => {\n\t\t\ta = a.zIndex || 0;\n\t\t\tb = b.zIndex || 0;\n\t\t\treturn +(a > b) || -(a < b);\n\t\t});\n\t}\n\n\t// Trigger the draw function\n\tdraw() {\n\n\t\tconst ctx = this.ctx;\n\n\t\t// Find items that have changed\n\t\t// Remove background\n\t\tthis.children.forEach(item => {\n\n\t\t\tif (item.frame) {\n\t\t\t\titem.frame(ctx);\n\t\t\t}\n\n\t\t\tif (item.dirty && item.visible !== false) {\n\t\t\t\titem.draw(ctx);\n\t\t\t}\n\n\t\t\titem.dirty = false;\n\t\t});\n\t}\n\n\telementFromPoint(x, y) {\n\n\t\tlet target;\n\n\t\t// Find the canvas item which this targets?\n\t\tconst obj = {\n\t\t\tx,\n\t\t\ty,\n\t\t\tw: 1,\n\t\t\th: 1\n\t\t};\n\n\t\tthis.children.forEach(item => {\n\n\t\t\tif (item.visible === false || !item.w || !item.h || item.pointerEvents === false) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Is this a target?\n\t\t\tif (intersect(obj, item)) {\n\t\t\t\t// Define this as a target\n\t\t\t\ttarget = item;\n\t\t\t}\n\t\t});\n\n\t\treturn target;\n\t}\n\n\t// The user has clicked an item on the page\n\taddEventListener(eventname, handler) {\n\n\t\t// Add to the events list\n\t\tif (!(eventname in this.events)) {\n\t\t\tthis.events[eventname] = [];\n\t\t}\n\n\t\tthis.events[eventname].push(handler);\n\t}\n\n\t// Dispatch\n\tdispatchEvent(e) {\n\t\tif (e.type in this.events)\n\t\t\tthis.events[e.type].forEach(handler => handler(e));\n\t}\n\n\t// Find and _dispatch\n\t_findAndDispatch(e) {\n\t\t// If this is not a pointerEvent lets just pass it through.\n\t\tif ((typeof MouseEvent !== 'undefined' && e instanceof MouseEvent) ||\n\t\t\t(typeof TouchEvent !== 'undefined' && e instanceof TouchEvent)) {\n\n\t\t\t// Find the canvas item which this targets?\n\t\t\tconst obj = {\n\t\t\t\tx: e.offsetX,\n\t\t\t\ty: e.offsetY,\n\t\t\t\tw: 1,\n\t\t\t\th: 1\n\t\t\t};\n\n\t\t\tthis.children.forEach(item => {\n\n\t\t\t\tif (!item.visible || !item.w || !item.h || !item.pointerEvents) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Intersects?\n\t\t\t\tintersect(obj, item) && item.dispatchEvent(e);\n\t\t\t});\n\t\t}\n\t}\n}\n\n\n// Intersect\n// Given two objects with, x,y,w,h properties\n// Do their rectangular dimensions intersect?\n// return Boolean true false.\nfunction intersect(a, b) {\n\treturn !(a.x > (b.x + b.w) ||\n\t(a.x + a.w) < b.x ||\n\ta.y > (b.y + b.h) ||\n\t(a.y + a.h) < b.y);\n}\n\nfunction displaced(a, b) {\n\treturn (a.x !== b.x ||\n\ta.y !== b.y ||\n\ta.w !== b.w ||\n\ta.h !== b.h);\n}\n", "// Shape\n// CanvasShapes\n// The parent object defining a basic shape, x,y,w,h, for starters.\n// And basic operatings you might like to include on a shape\nimport createEvent from 'tricks/events/createEvent';\n\nexport default class Shape {\n\n\tconstructor (...args) {\n\n\t\t// initieate  events\n\t\tthis.events = [];\n\n\t\t// Set previous\n\t\tthis.previous = {};\n\n\t\tif (args.length) {\n\t\t\t// Store the values\n\t\t\tthis.position(...args);\n\t\t}\n\t}\n\n\t//\tSet property listeners\n\tget x() {\n\t\treturn this._x;\n\t}\n\tset x(x) {\n\t\tthis.positionObj({x});\n\t}\n\n\tget y() {\n\t\treturn this._y;\n\t}\n\tset y(y) {\n\t\tthis.positionObj({y});\n\t}\n\n\tget w() {\n\t\treturn this._w;\n\t}\n\tset w(w) {\n\t\tthis.positionObj({w});\n\t}\n\n\tget h() {\n\t\treturn this._h;\n\t}\n\tset h(h) {\n\t\tthis.positionObj({h});\n\t}\n\n\tget dx() {\n\t\treturn this._dx;\n\t}\n\tset dx(v) {\n\t\tif (this._dx !== v) {\n\t\t\tthis.dirty = true; this._dx = v;\n\t\t}\n\t}\n\n\tget dy() {\n\t\treturn this._dy;\n\t}\n\tset dy(v) {\n\t\tif (this._dy !== v) {\n\t\t\tthis.dirty = true; this._dy = v;\n\t\t}\n\t}\n\n\tget visible() {\n\t\treturn (this._visible === undefined ? true : this._visible);\n\t}\n\tset visible(v) {\n\t\tif (this._visible !== v) {\n\t\t\tthis.dirty = true; this._visible = v;\n\t\t}\n\t}\n\n\tget opacity() {\n\t\treturn (this._opacity === undefined ? 1 : this._opacity);\n\t}\n\tset opacity(v) {\n\t\tif (this._opacity !== v) {\n\t\t\tthis.dirty = true; this._opacity = v;\n\t\t}\n\t}\n\n\tset dirty (v) {\n\t\t// Has this just been made dirty?\n\t\tif (!this._dirty && v) {\n\t\t\t// Mark as dirty\n\t\t\tthis._dirty = v;\n\n\t\t\t// Trigger a canvas clean\n\t\t\tthis.dispatchEvent(createEvent('dirty'));\n\t\t}\n\t\telse if (!v) {\n\t\t\t// reset\n\t\t\tthis._dirty = v;\n\n\t\t\t// Store the previous values\n\t\t\tthis.previous = {\n\t\t\t\tx: this._x,\n\t\t\t\ty: this._y,\n\t\t\t\tw: this._w,\n\t\t\t\th: this._h,\n\t\t\t};\n\t\t}\n\t}\n\tget dirty () {\n\t\treturn this._dirty;\n\t}\n\n\t// Let events bubble up\n\tget pointerEvents () {\n\t\treturn (this._pointerEvents === undefined ? 1 : this._pointerEvents);\n\t}\n\tset pointerEvents (v) {\n\t\tthis._pointerEvents = v;\n\t}\n\n\t// Mark the shape as to be removed from the collection\n\tremove() {\n\t\tthis.dirty = true;\n\t\tthis.visible = false;\n\t}\n\n\tposition(x = 0, y = 0, w = 0, h = 0) {\n\n\t\t// Assign, rectangle shape\n\t\t// Have a backup footprint\n\t\tthis.positionObj({x, y, w, h});\n\t}\n\n\tpositionObj(coords) {\n\t\tfor (const coord in coords) {\n\t\t\tconst value = coords[coord];\n\t\t\tconst current = this[`_${coord}`];\n\t\t\tif (current !== value) {\n\t\t\t\tthis.dirty = true;\n\t\t\t\tthis[`_${coord}`] = value;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Placeholder function for drawing to canvas\n\tframe() {}\n\tdraw() {}\n\tsetup() {}\n\n\t// Events\n\t// Assign Events to be fired when the user clicks this object\n\t// Awesome\n\taddEventListener(eventName, callback) {\n\t\tif (!(eventName in this.events)) {\n\t\t\tthis.events[eventName] = [];\n\t\t}\n\t\tthis.events[eventName].push(callback);\n\t}\n\n\tdispatchEvent(e) {\n\t\tif (!(e.type in this.events)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.events[e.type].forEach(fn => fn(e));\n\t}\n\n\t// Assign getters and setters to default properties\n\t_watchProperty(propName) {\n\t\tObject.defineProperty(this, propName, {\n\t\t\tget: this._getter.bind(this, propName),\n\t\t\tset: this._setter.bind(this, propName)\n\t\t});\n\t}\n\n\t_getter(propName) {\n\t\treturn this[`_${ propName}`];\n\t}\n\n\t_setter(propName, v) {\n\t\tif (this[`_${ propName}`] !== v) {\n\t\t\tthis.dirty = true;\n\t\t\tthis[`_${ propName}`] = v;\n\t\t}\n\t}\n}\n", "// text\n// TextObject, defines a shape object which contains text.\n\nimport Shape from './shape';\n\nexport default class Text extends Shape {\n\n\t// Initiate a new shape object.\n\tconstructor (text) {\n\t\t// initiate inheritance\n\t\tsuper();\n\n\t\t// Watch the following properties for changes\n\t\t['text', 'shadowBlur', 'shadowColor', 'fillStyle', 'strokeStyle', 'textAlign', 'textBaseline', 'lineWidth'].forEach(this._watchProperty.bind(this));\n\n\t\t// Define text\n\t\tthis.text = text || '';\n\n\t\tthis.shadowColor = 'black';\n\t\tthis.fillStyle = 'black';\n\t\tthis.strokeStyle = 'white';\n\t\tthis.textAlign = 'left';\n\t\tthis.textBaseline = 'top';\n\t\tthis.lineWidth = 0;\n\t\tthis.align = 'left top';\n\t\tthis.fontSize = 30;\n\t}\n\n\t// Define the text and the alignment of the object\n\tcalc (canvas) {\n\n\t\t// Define text\n\t\t[this.textAlign, this.textBaseline] = this.align.split(' ');\n\n\t\tconst ctx = canvas.ctx;\n\t\tlet fontSize = this.fontSize;\n\n\t\t// Split text by line breaks\n\t\tthis.lines = this.text.toString().split('\\n');\n\n\t\t// Which is the longest line?\n\t\tlet _width = 0;\n\t\tlet default_text = this.lines[0];\n\n\t\tthis.lines.forEach(line => {\n\t\t\tconst _w = ctx.measureText(line).width;\n\t\t\tif (_w > _width) {\n\t\t\t\t_width = _w;\n\t\t\t\tdefault_text = line;\n\t\t\t}\n\t\t});\n\n\t\t// Find the width and height of the item\n\t\t// Using the canvas context\n\t\tctx.save();\n\n\t\tctx.shadowColor = 'black';\n\t\tctx.fillStyle = 'black';\n\t\tctx.strokeStyle = 'rgba(255,255,255,0.5)';\n\t\tctx.font = `bold ${ fontSize }px Arial`;\n\n\t\twhile (ctx.measureText(default_text).width > canvas.width) {\n\t\t\tfontSize *= 0.9;\n\t\t\tfontSize = Math.round(fontSize);\n\t\t\tctx.font = `bold ${ fontSize }px Arial`;\n\t\t}\n\n\t\tthis.shadowBlur = ctx.shadowBlur = Math.round(fontSize / 10);\n\t\tthis.fontSize = fontSize;\n\t\tthis.font = ctx.font;\n\n\t\tthis.w = ctx.measureText(default_text).width + (this.shadowBlur * 2);\n\t\tthis.h = (fontSize + (this.shadowBlur * 2)) * this.lines.length;\n\n\t\tctx.restore();\n\n\t\t// Store style attributes\n\t\t// Store the new attributes of the text item\n\t\tthis.lineWidth = Math.floor(fontSize / 60);\n\n\n\t\t// HEIGHT and WIDTH\n\t\tswitch (this.textAlign) {\n\t\t\tcase 'center':\n\t\t\tcase 'middle':\n\t\t\t\tthis.textAlign = 'center';\n\t\t\t\tthis.x = (canvas.width / 2) - (this.w / 2);\n\t\t\t\tbreak;\n\t\t\tcase 'left':\n\t\t\t\tthis.x = 0;\n\t\t\t\tbreak;\n\t\t\tcase 'right':\n\t\t\t\tthis.x = canvas.width - this.w;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tswitch (this.textBaseline) {\n\t\t\tcase 'center':\n\t\t\tcase 'middle':\n\t\t\t\tthis.textBaseline = 'middle';\n\t\t\t\tthis.y = (canvas.height / 2) - (this.h / 2);\n\t\t\t\tbreak;\n\t\t\tcase 'top':\n\t\t\t\tthis.y = 0;\n\t\t\t\tbreak;\n\t\t\tcase 'bottom':\n\t\t\t\tthis.y = canvas.height - this.h;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.textAlign = 'left';\n\t\tthis.textBaseline = 'top';\n\n\t\tctx.restore();\n\t}\n\n\t// Draw\n\tdraw (ctx) {\n\n\t\tctx.save();\n\n\t\tctx.globalAlpha = this.opacity;\n\n\t\tctx.shadowColor = this.shadowColor;\n\t\tif (this.shadowBlur) {\n\t\t\tctx.shadowBlur = this.shadowBlur;\n\t\t}\n\t\tctx.fillStyle = this.fillStyle;\n\t\tctx.strokeStyle = this.strokeStyle;\n\t\tctx.font = this.font;\n\n\t\tctx.textAlign = this.textAlign;\n\t\tctx.textBaseline = this.textBaseline;\n\t\tctx.lineWidth = this.lineWidth;\n\n\t\tif (this.lineWidth) {\n\t\t\tctx.lineWidth = this.lineWidth;\n\t\t}\n\n\t\tthis.lines = this.text.toString().split('\\n');\n\n\t\tconst len = this.lines.length;\n\n\t\tthis.lines.forEach((item, index) => {\n\t\t\tconst y = this.y + (this.h ? (index * (this.h / len)) : 0);\n\n\t\t\tctx.fillText(item, this.x, y);\n\t\t\tif (this.strokeStyle) {\n\t\t\t\tctx.strokeText(item, this.x, y);\n\t\t\t}\n\t\t});\n\n\t\tctx.restore();\n\t}\n}\n", "//\n// Rectangle\n//\n\nimport Shape from './shape';\n\nexport default class Rect extends Shape {\n\n\tconstructor(...args) {\n\t\tsuper(...args);\n\t}\n\n\tget fillStyle() {\n\t\treturn this._fillStyle;\n\t}\n\tset fillStyle(v) {\n\t\tif (this._fillStyle !== v) {\n\t\t\tthis.dirty = true;\n\t\t\tthis._fillStyle = v;\n\t\t}\n\t}\n\n\tget type() {\n\t\treturn 'rect';\n\t}\n\n\tdraw(ctx) {\n\n\t\tctx.save();\n\n\t\tif (this.dx || this.dy) {\n\t\t\tctx.translate(this.dx, this.dy);\n\t\t}\n\t\tctx.fillStyle = this.fillStyle;\n\t\tctx.fillRect(this.x, this.y, this.w, this.h);\n\t\tctx.restore();\n\t}\n}\n", "// Create a queuing function\n// Queues items in an Array like function until a handler has been defined\n// Then each item will be processed against the handler.\n// Useful for creating Global Asynchronous Queues, as can be retro fitted to existing arrays.\n\nexport default class Queue {\n\n\tconstructor(arr, handler) {\n\t\tthis.items = (Array.isArray(arr) ? arr : []);\n\t\tthis.handler = handler;\n\t}\n\n\t// Mimic the Array.push function\n\tpush(...args) {\n\n\t\t// Append items to the internal array.\n\t\targs.forEach(item => this.items.push(item));\n\n\t\t// Trigger the custom handler\n\t\tif (this._handler) {\n\t\t\targs.forEach(item => this._handler(item));\n\t\t}\n\t}\n\n\t// Mimic the length\n\tget length() {\n\t\treturn this.items.length;\n\t}\n\tset length(value) {\n\t\tthis.items.length = value;\n\t}\n\n\t// Set the item handler\n\tget handler() {\n\t\treturn this._handler;\n\t}\n\n\tset handler(callback) {\n\n\t\tthis._handler = callback;\n\n\t\tif (this._handler) {\n\t\t\tthis.items.forEach(item => this._handler(item));\n\t\t}\n\t}\n}\n", "// Background\n// Exposes the basic properties/methods of a controllable background\n\nimport Queue from 'tricks/object/Queue';\n\n// Extract the window.background items\nconst queue = window.background = new Queue(window.background);\n\nfunction queueHandler(callback) {\n\t// Each item in the queue should be a function\n\tcallback(Background);\n}\n\nexport default class Background {\n\n\tstatic add(stage) {\n\t\t// Store the\n\t\tBackground.stages.push(stage);\n\n\t\t// Trigger ready if it has not already been set\n\t\tif (Background.stages.length === 1) {\n\t\t\t// Initiate the queue\n\t\t\tqueue.handler = queueHandler;\n\t\t}\n\t}\n\n\t// Create a new instance of a stage\n\tstatic init(target) {\n\t\t// Get the default stage which has been registered with this class\n\t\tconst stage = Background.stages[0];\n\n\t\t// Return instance\n\t\tif (stage) {\n\t\t\treturn new stage(target);\n\t\t}\n\t}\n}\n\nBackground.stages = [];\n", "export const colours = {\n    red: '#ff595e',\n    green: '#8ac926',\n    blue: '#1982c4',\n    yellow: '#ffca3a',\n    purple: '#6a4c93',\n    grey: '#999999',\n};\n\nexport const palette = [colours.red, colours.green, colours.blue, colours.yellow, colours.purple, colours.grey];", "// Tetris, Canvas animation\n// Copyright Andrew Dodson, July 2017\n\n// Get Canvas\nimport Canvas from './classes/canvas.js';\nimport Collection from './classes/collection.js';\nimport Text from './classes/text.js';\nimport Shape from './classes/shape.js';\nimport Rect from './classes/rect.js';\nimport Background from './classes/Background.js';\nimport { colours } from './classes/colours.js';\n\n// Create a new tile\n// Arguments handled by parent\nclass Piece extends Shape {\n\n\tconstructor({gx, gy, tw, th, structure, color}) {\n\n\t\tconst x = tw * gx;\n\t\tconst y = th * gy;\n\t\tconst w = tw * structure[0].length;\n\t\tconst h = th * structure.length;\n\t\tsuper(x, y, w, h);\n\n\t\tthis.tw = tw;\n\t\tthis.th = th;\n\t\tthis.gx = gx;\n\t\tthis.gy = gy;\n\t\tthis.zIndex = 0;\n\t\tthis.color = color;\n\t\tthis.structure = structure;\n\t}\n\n\t// Rotate this item\n\trotate() {\n\t\t// Rotate piece\n\t\tconst a = [];\n\t\tconst rowCount = this.structure.length;\n\t\tthis.structure.forEach((row, rowIndex) => {\n\t\t\trow.forEach((value, colIndex) => {\n\t\t\t\t// Init array\n\t\t\t\tlet row = a[colIndex];\n\t\t\t\tif (!row) {\n\t\t\t\t\trow = [];\n\t\t\t\t\ta[colIndex] = row;\n\t\t\t\t}\n\n\t\t\t\t// The xIndex becomes the row index\n\t\t\t\ta[colIndex][rowCount - rowIndex - 1] = value;\n\t\t\t});\n\t\t});\n\n\t\tthis.structure = a;\n\t}\n\n\tpoints() {\n\t\tconst a = [];\n\t\tthis.structure.forEach((row, y) => {\n\t\t\t// Find the blocks in the row\n\t\t\trow.forEach((block, x) => {\n\t\t\t\tif (block) {\n\t\t\t\t\ta.push([x, y]);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn a;\n\t}\n\n\t// Each function passed into the collection must have a draw function\n\tdraw(ctx) {\n\t\tctx.fillStyle = this.color;\n\n\t\t// Draw\n\t\tthis.structure.forEach((row, yIndex) => {\n\t\t\tconst y = (yIndex * this.th);\n\t\t\trow.forEach((tile, xIndex) => {\n\t\t\t\tif (tile) {\n\t\t\t\t\tconst x = xIndex * this.tw;\n\t\t\t\t\tctx.fillRect(this.x + x, this.y + y, this.tw, this.th);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n\n// Define the shapes which go into making the game...\nconst pieces = [\n\t{\n\t\tcolor: colours.red,\n\t\tname: 'square',\n\t\tstructure: [\n\t\t\t[1, 1],\n\t\t\t[1, 1]\n\t\t]\n\t},\n\t{\n\t\tcolor: colours.green,\n\t\tname: 'left-l',\n\t\tstructure: [\n\t\t\t[0, 1, 0],\n\t\t\t[0, 1, 0],\n\t\t\t[0, 1, 1]\n\t\t]\n\t},\n\t{\n\t\tcolor: colours.green,\n\t\tname: 'right-l',\n\t\tstructure: [\n\t\t\t[0, 1, 0],\n\t\t\t[0, 1, 0],\n\t\t\t[1, 1, 0]\n\t\t]\n\t},\n\t{\n\t\tcolor: colours.blue,\n\t\tname: 'zig',\n\t\tstructure: [\n\t\t\t[1, 0, 0],\n\t\t\t[1, 1, 0],\n\t\t\t[0, 1, 0]\n\t\t]\n\t},\n\t{\n\t\tcolor: colours.yellow,\n\t\tname: 'zag',\n\t\tstructure: [\n\t\t\t[0, 1, 0],\n\t\t\t[1, 1, 0],\n\t\t\t[1, 0, 0]\n\t\t]\n\t},\n\t{\n\t\tcolor: colours.purple,\n\t\tname: 'line',\n\t\tstructure: [\n\t\t\t[0, 1, 0, 0],\n\t\t\t[0, 1, 0, 0],\n\t\t\t[0, 1, 0, 0],\n\t\t\t[0, 1, 0, 0]\n\t\t]\n\t},\n\t{\n\t\tcolor: colours.grey,\n\t\tname: 'middle',\n\t\tstructure: [\n\t\t\t[0, 1, 0],\n\t\t\t[0, 1, 1],\n\t\t\t[0, 1, 0]\n\t\t]\n\t}\n];\n\nclass Stage extends Canvas {\n\n\tconstructor(target) {\n\n\t\t// Initiate the canvas in the base\n\t\tsuper(target);\n\n\t\t// Collection\n\t\t// Define the canvas start element\n\t\tthis.collection = new Collection(this.target);\n\n\t\t// Add listeners to the canvas Element\n\t\tthis.addEventListener('frame', this.frame.bind(this));\n\n\t\t// Add listeners to the canvas Element\n\t\tthis.addEventListener('resize', this.reset.bind(this));\n\n\t\t// Show text\n\t\tthis.options = {\n\t\t\tcontrols: true\n\t\t};\n\n\t\t// Board\n\t\tthis.board = [];\n\n\t\tconst credits = new Text();\n\t\tcredits.text = 'Game Over';\n\t\tcredits.zIndex = 1;\n\t\tcredits.fontSize = 150;\n\t\tcredits.align = 'center center';\n\t\tcredits.addEventListener('click', this.reset.bind(this));\n\t\tcredits.visible = false;\n\t\tthis.credits = credits;\n\n\t\tconst score = new Text();\n\t\tscore.zIndex = 1;\n\t\tscore.text = 0;\n\t\tscore.align = 'right bottom';\n\t\tscore.pointerEvents = false;\n\t\tscore.fontSize = 40;\n\t\tthis.score = score;\n\n\t\t// Is this playing as a background image?\n\t\t// We want to display a button to enable playing in full screen.\n\t\tconst info = new Text();\n\t\tinfo.text = 'Click to start';\n\t\tinfo.zIndex = 1;\n\t\tinfo.align = 'center center';\n\t\tinfo.fontSize = 40;\n\t\tinfo.calc(this);\n\t\tthis.info = info;\n\n\n\t\t// // User has clicked an item on the canvas\n\t\t// // We'll use event delegation to tell us what the user has clicked.\n\t\t// this.addEventListener('click', this.click.bind(this));\n\n\t\t// User has clicked an item on the canvas\n\t\t// We'll use event delegation to tell us what the user has clicked.\n\t\tthis.addEventListener('keydown', this.keypress.bind(this));\n\n\t\t// This cadence\n\t\t// This sets the rate at which blocks move\n\t\t// And is roughly the [number] of milliseconcd it takes a block to move relative to it's own height.\n\t\tthis.cadence = 1000;\n\t\tthis.lastTick = 0;\n\t}\n\n\tsetup(options) {\n\t\tthis.config(structuredClone(options));\n\n\t\t// Setup the board\n\t\tthis.reset();\n\t}\n\n\tconfig(options = {}) {\n\t\tObject.assign(this.options, structuredClone(options));\n\t}\n\n\treset() {\n\n\t\t// Disable the ended state\n\t\tthis.ended = false;\n\n\t\t// Reset the currently playing piece\n\t\tthis.gamepiece = null;\n\n\t\t// Set the tilesize\n\t\tconst size = 50;\n\n\t\t// Remove everything\n\t\tthis.collection.length = 0;\n\n\t\t// Board\n\t\t// Break the board down into squares\n\t\t// At each square there can exist a reference to a piece\n\t\tthis.board.length = 0;\n\n\t\t{\n\t\t\t// Set number of tiles horizontally and vertically\n\t\t\tthis.nx = Math.floor(this.width / size);\n\t\t\tthis.ny = Math.floor(this.height / size);\n\n\t\t\t// Adjust the tile dimensions\n\t\t\tthis.tw = size + Math.floor((this.width % (this.nx * size)) / this.nx);\n\t\t\tthis.th = size + Math.floor((this.height % (this.ny * size)) / this.ny);\n\n\t\t\t// Create board matrix\n\t\t\tfor (let y = 0; y < this.ny; y++) {\n\t\t\t\tthis.board[y] = [];\n\t\t\t\tfor (let x = 0; x < this.nx; x++) {\n\t\t\t\t\tthis.board[y][x] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Score\n\t\tthis.score.text = 0;\n\t\tthis.score.calc(this);\n\n\t\t// Add text items\n\t\tthis.collection.push(this.credits);\n\t\tthis.collection.push(this.info);\n\t\tthis.collection.push(this.score);\n\n\t\t// Sort the collection by z-index this ensures everything is drawn in the right order\n\t\tthis.collection.sort();\n\n\t\t// Clear the canvas\n\t\tthis.clear();\n\n\t\t// Show Controls\n\t\tthis.controls();\n\t}\n\n\tcontrols() {\n\t\tconst controls = this.options.controls;\n\t\t// Show Controls and information?\n\t\tthis.score.visible = controls;\n\t\tthis.credits.visible = controls && this.ended;\n\t\tthis.info.visible = controls && this.ended;\n\t}\n\n\tframe() {\n\n\t\tif (!this.ended) {\n\n\t\t\tconst now = performance.now();\n\n\t\t\t// Mark that this has a difference in Y\n\t\t\t// This is used later to say whether a move to the left or right is possible.\n\t\t\tthis.diff = Math.min((now - this.lastTick) / this.cadence, 1) % 1;\n\n\t\t\t// Grab the current game piece and change it's vertical position\n\t\t\tif (this.gamepiece) {\n\n\t\t\t\t// Can this piece move down?\n\t\t\t\t// Find the matrix\n\t\t\t\tthis.gamepiece.y = parseInt((this.diff + this.gamepiece.gy) * this.th, 10);\n\t\t\t}\n\n\t\t\t// Is this a big move\n\t\t\tif (this.diff === 0) {\n\n\t\t\t\t// Update the lastTick\n\t\t\t\tthis.lastTick = now;\n\n\t\t\t\t// Trigger the tick\n\t\t\t\tthis.tick();\n\t\t\t}\n\t\t}\n\n\t\t// On every frame\n\t\t// Prepare dirty areas\n\t\tthis.collection.prepare();\n\n\t\t// Draw marked items\n\t\tthis.collection.draw();\n\t}\n\n\t// This is the game tick\n\t// The rate at which this is controlled varies depending on the game cadence\n\t// For instance this should initially be set to a fall rate of 1 block every second\n\t// When the game evolves the tick can be called more frequently\n\n\ttick() {\n\n\t\tif (this.gamepiece) {\n\t\t\t// Compare the position of the gamepiece and determine whether it's free to move down\n\t\t\t// - if not trigger the end and fix it in place\n\n\t\t\t// The gamepiece has a structure as does the board\n\t\t\t// Compare the position of the blocks which makes up the game piece\n\t\t\t// - in relation to the relative structure of the board\n\n\t\t\t// Update the gamepieces position...\n\t\t\tthis.move({y: 1});\n\t\t}\n\t\t// Else create a game shape and position it on the board\n\t\telse {\n\n\t\t\tconst {tw, th, nx} = this;\n\t\t\tconst piece = random(pieces);\n\t\t\tconst xlen = piece.structure[0].length;\n\t\t\tconst ylen = piece.structure.length;\n\n\t\t\t// Find the starting grid position of the piece\n\t\t\tconst gx = Math.ceil((nx - xlen) / 2);\n\t\t\tconst gy = -ylen;\n\n\t\t\t// Create the piece\n\t\t\tconst options = Object.assign({\n\t\t\t\tgx,\n\t\t\t\tgy,\n\t\t\t\ttw,\n\t\t\t\tth\n\t\t\t}, piece);\n\n\t\t\tthis.gamepiece = new Piece(options);\n\t\t\tthis.collection.push(this.gamepiece);\n\n\t\t\t// Draw marked items\n\t\t\tthis.collection.sort();\n\t\t}\n\t}\n\n\tclick() {\n\t\t// Find the gamepiece and trigger a rotation\n\t\tthis.rotate();\n\t}\n\n\trotate() {\n\t\t// Find the gamepiece and trigger a rotation\n\t\tif (this.gamepiece) {\n\t\t\tthis.gamepiece.rotate();\n\t\t}\n\t}\n\n\tcanMove(cords) {\n\t\t// Props of the gamepiece\n\t\tconst {gx, gy} = this.gamepiece;\n\t\tconst {x = 0, y = 0} = cords;\n\n\t\t// Can move?\n\t\tconst points = this.gamepiece.points();\n\n\t\t// Is there something at this point on the board?\n\t\treturn !points.find(([px, py]) => {\n\n\t\t\t// For a sideways move having already fallen half way also check an intermediate position\n\t\t\tif (this.diff && x && !y && this.point(px + x + gx, py + y + gy + 1)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Check the position\n\t\t\treturn this.point(px + x + gx, py + y + gy);\n\t\t});\n\t}\n\n\tpoint(x, y) {\n\n\t\t// Allow items to fall from beyond the top\n\t\tif (y < 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Out of bounds\n\t\tif ((y >= this.ny) || (x < 0 || x >= this.nx)) {\n\t\t\t// out of bounds\n\t\t\treturn 1;\n\t\t}\n\n\t\t// Whats there?\n\t\treturn this.board[y][x];\n\t}\n\n\t// Triggered when the gamepiece has reached the bottom\n\trestGamepiece() {\n\n\t\t// Set the gamepiece on the board\n\t\tconst points = this.gamepiece.points();\n\t\tconst {gx, gy} = this.gamepiece;\n\n\t\t// Is the item resting on/above the top?\n\t\tif (gy <= 0) {\n\t\t\tthis.end();\n\t\t\treturn;\n\t\t}\n\n\t\t// Mark the board as having filled in\n\t\tpoints.forEach(([px, py]) => {\n\t\t\tconst x = px + gx;\n\t\t\tconst y = py + gy;\n\n\t\t\t// Recreate the square\n\t\t\tconst tile = new Rect(this.tw * x, this.th * y, this.tw, this.th);\n\t\t\ttile.zIndex = 0;\n\t\t\ttile.fillStyle = this.gamepiece.color;\n\t\t\tthis.collection.push(tile);\n\n\t\t\tthis.board[y][x] = tile;\n\t\t});\n\n\t\t// Remove the gamepiece\n\t\tthis.gamepiece.remove();\n\n\t\t// Reset the swipe position\n\t\tthis.swipeStart = null;\n\n\t\t// Create a list of marked row indexes to remove from the board\n\t\tconst marked = [];\n\n\t\t// Completed rows?\n\t\tthis.board.forEach((row, index) => {\n\n\t\t\t// Ignore rows where every tile is not laid\n\t\t\tif (row.filter(a => a).length !== this.nx) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Detach all tile objects\n\t\t\trow.forEach(tile => tile.remove());\n\n\t\t\t// Add this row index to the marked list\n\t\t\tmarked.push(index);\n\t\t});\n\n\t\t// There are rows to remove\n\t\tif (marked.length) {\n\n\t\t\t// Remove items from the bottom\n\t\t\tmarked.reverse().forEach(index => this.board.splice(index, 1));\n\n\t\t\t// Add items to the top\n\t\t\tmarked.forEach(() => {\n\t\t\t\tthis.board.unshift([]);\n\t\t\t});\n\n\t\t\t// Loop through and reposition every tile\n\t\t\tthis.board.forEach((row, rowIndex) => {\n\t\t\t\trow.forEach(tile => {\n\t\t\t\t\tif (tile) {\n\t\t\t\t\t\ttile.y = rowIndex * this.th;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Add a score\n\t\t\tthis.score.text += marked.length;\n\t\t\tthis.score.calc(this);\n\t\t}\n\t}\n\n\tmove({x = 0, y = 0}) {\n\n\t\t// Move the game piece\n\t\tif (this.gamepiece && this.canMove({x, y})) {\n\n\t\t\tthis.gamepiece.gx += x;\n\t\t\tthis.gamepiece.x = (this.gamepiece.gx * this.tw);\n\n\t\t\tthis.gamepiece.gy += y;\n\t\t\tthis.gamepiece.y = (this.gamepiece.gy * this.th);\n\n\t\t\t// Free to continue falling?\n\t\t\tif (!this.canMove({y: 1})) {\n\t\t\t\t// Rest game[iece]\n\t\t\t\tthis.restGamepiece();\n\n\t\t\t\t// Remove it\n\t\t\t\tthis.gamepiece = null;\n\t\t\t}\n\n\t\t\t// This moved successfully\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tkeypress({key}) {\n\t\tswitch (key) {\n\t\t\tcase 'ArrowRight': {\n\t\t\t\tthis.move({x: 1});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'ArrowLeft': {\n\t\t\t\tthis.move({x: -1});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'ArrowDown': {\n\t\t\t\tthis.move({y: 1});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'ArrowUp': {\n\t\t\t\tthis.rotate();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ' ': {\n\t\t\t\tthis.rotate();\n\t\t\t}\n\t\t}\n\t}\n\n\tswipe(e) {\n\n\t\t// Set prevent default to stop any mouse events from also being called\n\t\tif ((typeof TouchEvent !== 'undefined') && e instanceof TouchEvent) {\n\t\t\t// Prevent the triggering of the mouse events\n\t\t\te.preventDefault();\n\t\t}\n\n\t\tconst type = e.gesture.type;\n\n\t\tif (type === 'start' && this.ended) {\n\t\t\tthis.reset();\n\t\t\treturn;\n\t\t}\n\n\t\t// Is this a release?\n\t\tif (type === 'release' || type === 'click' || !this.gamepiece) {\n\n\t\t\t// This has ended\n\t\t\tthis.swipeStart = null;\n\n\t\t\tif (e.gesture.deltaTime < 200) {\n\t\t\t\tthis.rotate();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t// Start a new one\n\t\tif (type === 'start') {\n\t\t\t// Record the new start piece\n\t\t\tthis.swipeStartGamePiece = this.gamepiece;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.swipeStartGamePiece !== this.gamepiece) {\n\t\t\t// This will force a new touch\n\t\t\treturn;\n\t\t}\n\n\n\t\t// Set the initial position of the block\n\t\tif (!this.swipeStart) {\n\t\t\tthis.swipeStart = {\n\t\t\t\tx: this.gamepiece.gx,\n\t\t\t\ty: this.gamepiece.gy\n\t\t\t};\n\t\t}\n\n\t\t// Using the delta positioning and the tile difference work out how far we can move this\n\t\tconst deltaX = parseInt(e.gesture.deltaX / this.tw, 10);\n\t\tconst deltaY = parseInt(e.gesture.deltaY / this.th, 10);\n\n\t\t// How far has the current grid changed\n\t\tconst x = this.swipeStart.x - this.gamepiece.gx + deltaX;\n\n\t\t// The y value can only be positive\n\t\tconst y = Math.max(this.swipeStart.y - this.gamepiece.gy + deltaY, 0);\n\n\t\t//\n\t\tthis.move({x, y});\n\n\t}\n\n\tend() {\n\t\t// Set ended state...\n\t\tthis.ended = true;\n\n\t\t// Visible Controls\n\t\tthis.controls();\n\n\t\t// \"Game Over\"\n\t\tthis.credits.calc(this);\n\n\t\t// \"You scored 42\"\n\t\tthis.info.calc(this);\n\t\tthis.info.y = this.info.y + this.credits.h;\n\t\tthis.info.text = `You scored ${this.score.text}`;\n\n\t}\n}\n\n\n// Add Stage to the background\nBackground.add(Stage);\n\n\n// Select a random item in an array\nfunction random(arr) {\n\treturn arr[Math.floor(arr.length * Math.random())];\n}"],
  "mappings": "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",
  "names": ["callback", "requestAnimationFrame_default", "dict", "createEvent", "eventname", "options", "createEvent_default", "createDummyEvent_default", "e", "instanceOf_default", "test", "root", "_HTMLElement", "_HTMLDocument", "_Window", "isDom_default", "test", "instanceOf_default", "toArray", "obj", "toArray_default", "each", "matches", "callback", "isDom_default", "instanceOf_default", "toArray_default", "SEPERATOR", "supportsPassive", "opts", "on", "elements", "eventnames", "callback", "options", "each", "el", "eventname", "pointerEnabled", "eventMoveTypes", "eventStartTypes", "eventEndTypes", "touch", "elements", "onmove", "onstart", "onend", "cb", "mv", "fin", "on", "moveEvent", "voidEvent", "i", "handler", "prevEvent", "gesture", "e", "each", "element", "startEvent", "prevMoveEvent", "endEvent", "currEvent", "dx", "dy", "event", "swipe", "elements", "callback", "touch", "e", "o", "s", "gesture", "g", "BACKGROUND_HASH", "UserEvents", "TouchEvents", "EVENT_SEPARATOR", "Canvas", "canvas", "parent", "on", "style", "initialZ", "hashchange", "swipe", "value", "now", "height", "width", "changed", "createEvent_default", "eventnames", "handler", "eventname", "e", "createDummyEvent_default", "touch", "z", "zIndex", "UserEvents", "Collection", "target", "on", "item", "fn", "v", "ctx", "displaced", "sibling", "intersect", "a", "b", "x", "y", "obj", "eventname", "handler", "e", "Shape", "args", "x", "y", "w", "h", "v", "createEvent_default", "coords", "coord", "value", "eventName", "callback", "e", "fn", "propName", "Text", "Shape", "text", "canvas", "ctx", "fontSize", "_width", "default_text", "line", "_w", "len", "item", "index", "y", "Rect", "Shape", "args", "v", "ctx", "Queue", "arr", "handler", "args", "item", "value", "callback", "queue", "Queue", "queueHandler", "callback", "Background", "_Background", "stage", "target", "colours", "palette", "Piece", "Shape", "gx", "gy", "tw", "th", "structure", "color", "x", "y", "w", "h", "a", "rowCount", "row", "rowIndex", "value", "colIndex", "block", "ctx", "yIndex", "tile", "xIndex", "pieces", "colours", "Stage", "Canvas", "target", "Collection", "credits", "Text", "score", "info", "options", "size", "controls", "now", "nx", "piece", "random", "xlen", "ylen", "cords", "px", "py", "points", "Rect", "marked", "index", "key", "e", "type", "deltaX", "deltaY", "Background", "arr"]
}
